// =============================================================================
// PapelerÃ­a Store - Esquema de base de datos (DBML)
// Integrado con frontend actual y propuesta de CMS
// =============================================================================

// -----------------------------------------------------------------------------
// AUTENTICACIÃ“N Y USUARIOS
// -----------------------------------------------------------------------------

Table roles {
  id int [pk, increment]
  name varchar(50) [unique, not null] // 'admin' | 'user'
  created_at timestamp [default: `now()`]
}

Table users {
  id int [pk, increment]
  role_id int [not null, ref: > roles.id]
  name varchar(100) [not null]
  email varchar(150) [unique, not null]
  password varchar(255) [not null]
  is_active boolean [default: true]
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
}

// -----------------------------------------------------------------------------
// CATEGORÃAS (soporta jerarquÃ­a para Navbar: Escolar > Cuadernos, Estuches...)
// -----------------------------------------------------------------------------

Table categories {
  id int [pk, increment]
  parent_id int [ref: > categories.id] // null = categorÃ­a padre (Escolar, Escritura, etc.)
  name varchar(100) [not null]
  slug varchar(100) [unique] // url-friendly: 'escolares', 'cuadernos'
  description text
  icon varchar(50) // FontAwesome: 'fas fa-book'
  color varchar(20) // hex para Ã­conos en dropdown: '#FF6B9D'
  display_order int [default: 0] // orden en menÃº
  is_active boolean [default: true]
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
}

// -----------------------------------------------------------------------------
// PRODUCTOS
// -----------------------------------------------------------------------------

Table products {
  id int [pk, increment]
  category_id int [not null, ref: > categories.id]
  name varchar(150) [not null]
  slug varchar(150) [unique] // url-friendly: 'boligrafos-premium'
  description text
  brand varchar(100) // Staedtler, Moleskine, etc. (para FilterPanel)
  price decimal(10,2) [not null]
  stock int [default: 0]
  sku varchar(100) [unique]
  mayoreo boolean [default: true] // vende por mayoreo
  menudeo boolean [default: true] // vende por menudeo
  is_active boolean [default: true]
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
}

Table product_images {
  id int [pk, increment]
  product_id int [not null, ref: > products.id]
  image_url varchar(500) [not null]
  is_primary boolean [default: false] // una por producto como principal
  display_order int [default: 0]
}

// -----------------------------------------------------------------------------
// OFERTAS (driven badges -20%, HOT, y precios originales en ProductDetail)
// -----------------------------------------------------------------------------

Table offers {
  id int [pk, increment]
  name varchar(100) [not null] // "Descuento verano", "HOT"
  badge_type varchar(20) [not null] // 'discount' | 'sale'
  badge_value varchar(20) [not null] // '-20%', 'HOT', 'NUEVO'
  discount_type varchar(20) [not null] // 'percentage' | 'fixed'
  discount_value decimal(10,2) [not null]
  start_date datetime [not null]
  end_date datetime [not null]
  is_active boolean [default: true]
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
}

Table offer_products {
  offer_id int [not null, ref: > offers.id]
  product_id int [not null, ref: > products.id]
  original_price decimal(10,2) // precio antes del descuento (opcional, si difiere del cÃ¡lculo)
  
  indexes {
    (offer_id, product_id) [pk]
  }
}

// -----------------------------------------------------------------------------
// BANNERS (carrusel principal del Home)
// -----------------------------------------------------------------------------

Table banners {
  id int [pk, increment]
  title varchar(150) [not null]
  subtitle varchar(255)
  price_display varchar(100) // texto: "A: $1,699.99", "40% OFF"
  old_price_display varchar(100) // "De: $3,338"
  sku varchar(50)
  image_url varchar(500)
  background_css varchar(255) // gradiente: 'linear-gradient(...)'
  badge varchar(50) // "PRECIO ESPECIAL", "AHORRA $13,300"
  description text
  icon varchar(20) // emoji/icono: 'ðŸŽ¨', 'ðŸ–¨ï¸'
  link_url varchar(255) // destino al hacer clic (ej: /all-products?banner=1)
  display_order int [default: 0]
  is_active boolean [default: true]
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
}

// -----------------------------------------------------------------------------
// SECCIONES DEL HOME (configuraciÃ³n CMS: quÃ© carruseles/grids mostrar)
// -----------------------------------------------------------------------------

Table home_sections {
  id int [pk, increment]
  type varchar(20) [not null] // 'carousel' | 'grid'
  title varchar(150) // "â­ Productos Destacados", "ðŸŽ¨ Arte & Manualidades"
  category_id int [ref: > categories.id] // si type=carousel por categorÃ­a
  product_ids json // [1,2,3,4,5,6] IDs fijos para "destacados"
  limit_products int [default: 6] // cuÃ¡ntos productos mostrar
  display_order int [default: 0]
  is_visible boolean [default: true]
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
}

// -----------------------------------------------------------------------------
// CARRITO (para usuarios autenticados; visitantes usan localStorage)
// -----------------------------------------------------------------------------

Table cart_items {
  id int [pk, increment]
  user_id int [not null, ref: > users.id]
  product_id int [not null, ref: > products.id]
  quantity int [not null, default: 1]
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
  
  indexes {
    (user_id, product_id) [unique]
  }
}

// -----------------------------------------------------------------------------
// PEDIDOS
// -----------------------------------------------------------------------------

Table orders {
  id int [pk, increment]
  user_id int [not null, ref: > users.id]
  total decimal(10,2) [not null]
  status varchar(20) [default: 'pending'] // 'pending' | 'paid' | 'shipped' | 'cancelled'
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
}

Table order_items {
  id int [pk, increment]
  order_id int [not null, ref: > orders.id]
  product_id int [not null, ref: > products.id]
  quantity int [not null]
  price decimal(10,2) [not null] // precio al momento de la compra
  created_at timestamp [default: `now()`]
}
